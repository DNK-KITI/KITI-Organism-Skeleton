# BalanceControlLayer · Слой управления балансом

## 1. Назначение

BalanceControlLayer — это слой управления равновесием организма KITI.
Он следит за положением центра масс, распределением опоры и устойчивостью
всего тела при движении, поворотах, прыжках и работе с нагрузкой.

Главная цель слоя:

- не дать организму упасть,
- минимизировать риск срыва опоры,
- вовремя перераспределять нагрузки по конечностям и суставам.

---

## 2. Источники данных

BalanceControlLayer опирается на данные:

- SensorCore (гироскопы, акселерометры, IMU),
- OrientationCore (углы наклона и направление корпуса),
- StabilityCore (текущий уровень устойчивости),
- LimbController (состояние конечностей),
- MotorCore и MotorPlanningCore (движения и траектории),
- EnvironmentCore (тип поверхности и внешние условия).

---

## 3. Основные задачи слоя

- отслеживание центра масс организма;
- анализ площади и качества опорной базы;
- прогноз риска потери равновесия;
- выдача корректирующих команд в MotorCore и MotorPlanningCore;
- взаимодействие с ReflexCore при критических состояниях;
- динамическая адаптация под разные типы движения (шаг, бег, поворот, подъем по лестнице).

---

## 4. Механика работы

1. BalanceControlLayer получает телеметрию о положении корпуса, наклоне, ускорениях.
2. Вычисляет текущий центр масс относительно опорных точек (ступни, лапы, колеса и т.п.).
3. Оценивает устойчивость по набору показателей:
   - угол наклона,
   - направление ускорения,
   - коэффициент трения поверхности,
   - скорость перемещения.
4. При риске потери равновесия:
   - корректирует шаг или траекторию;
   - отдаёт команду MotorCore на перераспределение усилий;
   - при критике — вызывает ReflexCore (быстрый шаг, шаг-вперёд, приседание, расширение опоры).

---

## 5. Связь с другими модулями

- **StabilityCore** — даёт оценку общей устойчивости (числовой уровень).
- **MotorCore / MotorPlanningCore** — получает корректировки траекторий и усилий.
- **CollisionCore** — сообщает о столкновениях, которые требуют балансировки.
- **LimbController** — уточняет какие опоры сейчас активны.
- **EnvironmentCore** — даёт контекст среды (лед, лестница, рыхлый грунт и т.п.).

---

## 6. Значение для организма KITI

Без BalanceControlLayer организм:

- чаще теряет равновесие,
- сильнее изнашивает суставы и моторы,
- хуже держит стойку под нагрузкой,
- опасен при работе рядом с людьми и объектами.

Слой баланса — это «внутренний тренер», который постоянно удерживает организм
в устойчивом положении и не даёт ему превратиться в неуправляемый груз металла.
